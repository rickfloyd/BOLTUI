{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Quantum CyberVision platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "username": {
          "type": "string",
          "description": "The user's chosen username."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "registrationDate": {
          "type": "string",
          "description": "Date and time the user registered.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "registrationDate"
      ]
    },
    "DashboardConfig": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DashboardConfig",
      "type": "object",
      "description": "Stores the configuration for a user's personalized dashboard.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the dashboard configuration."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 DashboardConfig)"
        },
        "layout": {
          "type": "string",
          "description": "The layout of the dashboard (e.g., '3-column')."
        },
        "widgets": {
          "type": "array",
          "description": "An array of widget identifiers to display on the dashboard.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "layout",
        "widgets"
      ]
    },
    "MarketData": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MarketData",
      "type": "object",
      "description": "Represents real-time market data for various financial instruments.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the market data entry."
        },
        "symbol": {
          "type": "string",
          "description": "The market symbol (e.g., EUR/USD)."
        },
        "price": {
          "type": "number",
          "description": "The current price of the instrument."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the data was retrieved.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "symbol",
        "price",
        "timestamp"
      ]
    },
    "AiSignal": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AiSignal",
      "type": "object",
      "description": "Represents a trading signal generated by the AI predictive analysis tool.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AI signal."
        },
        "symbol": {
          "type": "string",
          "description": "The market symbol the signal applies to."
        },
        "signalType": {
          "type": "string",
          "description": "The type of signal (e.g., 'buy', 'sell')."
        },
        "confidence": {
          "type": "number",
          "description": "The confidence level of the signal (0-1)."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the signal was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "symbol",
        "signalType",
        "confidence",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information.  Accessible only to the user and administrators (via separate roles collection).",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/dashboardConfig/{dashboardConfigId}",
        "definition": {
          "entityName": "DashboardConfig",
          "schema": {
            "$ref": "#/backend/entities/DashboardConfig"
          },
          "description": "Stores dashboard configuration settings for each user. Path-based ownership ensures only the user can access their own dashboard configuration.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "dashboardConfigId",
              "description": "The unique identifier of the dashboard configuration."
            }
          ]
        }
      },
      {
        "path": "/market_data/{marketDataId}",
        "definition": {
          "entityName": "MarketData",
          "schema": {
            "$ref": "#/backend/entities/MarketData"
          },
          "description": "Stores real-time market data. Publicly accessible.",
          "params": [
            {
              "name": "marketDataId",
              "description": "The unique identifier for the market data entry."
            }
          ]
        }
      },
      {
        "path": "/ai_signals/{aiSignalId}",
        "definition": {
          "entityName": "AiSignal",
          "schema": {
            "$ref": "#/backend/entities/AiSignal"
          },
          "description": "Stores AI-generated trading signals. Access might be restricted based on roles (e.g., premium users).",
          "params": [
            {
              "name": "aiSignalId",
              "description": "The unique identifier for the AI signal."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "AdminRole",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Documents in this collection indicate admin status. Existence of a document for a user ID grants admin privileges.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user with admin privileges."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the AI Quantum Charts platform, emphasizing scalability, security, and ease of debugging. It adheres to the principle of Authorization Independence by denormalizing authorization data where necessary, avoiding hierarchical `get()` calls in security rules.  Data is segregated into collections based on access patterns (private vs. shared) to simplify security rules.  The design leverages path-based ownership for user-specific data and the Membership Map model for collaborative data (although no collaborative data was explicitly requested).  QAPs are supported by structural segregation, ensuring secure `list` operations, i.e., a user cannot list other users' dashboards.  Specifically:\n\n*   `/users/{userId}`: Stores individual user profiles.  Access is restricted to the user and potentially admins (using a separate `/roles_admin/{userId}` collection).  The `dashboardConfig` subcollection stores dashboard preferences specific to each user, using path-based ownership.\n*   `/market_data/{marketDataId}`: Stores real-time market data.  This data is considered public, so no specific authorization is required beyond rate limiting (handled outside of Firestore security rules).\n*   `/ai_signals/{aiSignalId}`: Stores AI-generated trading signals.  Access might be restricted to premium users or based on subscription status (again, `/roles_premium/{userId}` could be used).\n\nThis structure ensures atomic operations, clear authorization logic, and the ability to scale the platform effectively."
  }
}